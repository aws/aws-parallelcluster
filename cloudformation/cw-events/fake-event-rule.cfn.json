{
  "Parameters": {
    "HealthQueueArn": {
      "Description": "Arn of the target health SQS queue.",
      "Type": "String"
    }
  },
  "Resources": {
    "FakeScheduledEventRule": {
      "Properties": {
        "EventPattern": {
          "detail": {
            "eventTypeCategory": [
              "scheduledChange"
            ],
            "service": [
              "EC2"
            ]
          },
          "detail-type": [
            "Fake AWS Health Event"
          ],
          "source": [
            "fake.aws.health"
          ]
        },
        "State": "ENABLED",
        "Targets": [
          {
            "Arn": {
              "Ref": "HealthQueueArn"
            },
            "Id": "sqswatcher_target",
            "InputTransformer": {
              "InputPathsMap": {
                "Instances": "$.resources[0]"
              },
              "InputTemplate": "\"{\\\"Type\\\" : \\\"Notification\\\", \\\"Message\\\" : \\\"{\\\\\\\"StatusCode\\\\\\\":\\\\\\\"Scheduled_Events\\\\\\\",\\\\\\\"Description\\\\\\\":\\\\\\\"Detected scheduled events for instance <Instances>\\\\\\\",\\\\\\\"Event\\\\\\\":\\\\\\\"parallelcluster:EC2_SCHEDULED_EVENT\\\\\\\",\\\\\\\"EC2InstanceId\\\\\\\":\\\\\\\"<Instances>\\\\\\\"}\\\"}\""
            }
          }
        ]
      },
      "Type": "AWS::Events::Rule"
    }
  }
}
