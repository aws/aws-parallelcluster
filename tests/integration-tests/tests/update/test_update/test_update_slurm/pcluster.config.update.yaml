Image:
  Os: {{ os }}
Tags:
  - Key: key
    Value: value3
  - Key: key2
    Value: value2
CustomS3Bucket: {{ resource_bucket }}
HeadNode:
  InstanceType: {{ instance }}
  Networking:
    SubnetId: {{ public_subnet_id }}
  Ssh:
    KeyName: {{ key_name }}
  CustomActions:
    - Script: s3://{{ bucket }}/scripts/preinstall.sh
      Args:
        - ABC
      Event: NODE_START
    - Script: s3://{{ bucket }}/scripts/postinstall.sh
      Args:
        - DEF
      Event: NODE_CONFIGURED
  Iam:
    S3Access:
      - BucketName: {{ resource_bucket }}
        EnableWriteAccess: true
    AdditionalIamPolicies:
      - Policy: arn:aws:iam::aws:policy/service-role/AmazonAppStreamServiceAccess
Scheduling:
  Scheduler: {{ scheduler }}
  SlurmSettings:
    ScaledownIdletime: 30
  Queues:
    - Name: queue1
      ComputeSettings:
        LocalStorage:
         RootVolume:
          size: 40
      CustomActions:
        - Script: s3://{{ bucket }}/scripts/preinstall.sh
          Args:
            - ABC
          Event: NODE_START
        - Script: s3://{{ bucket }}/scripts/postinstall.sh
          Args:
            - DEF
          Event: NODE_CONFIGURED
      CapacityType: SPOT
      ComputeResources:
        - Name: compute-resource-11
          InstanceType: c5.xlarge
          MinCount: 2
          MaxCount: 4
        - Name: compute-resource-12
          InstanceType: c5.2xlarge
          SpotPrice: 2.1
        - Name: compute-resource-13
            InstanceType: t2.micro
      Iam:
        S3Access:
          - BucketName: {{ resource_bucket }}
            EnableWriteAccess: true
        AdditionalIamPolicies:
          - Policy: arn:aws:iam::aws:policy/service-role/AmazonAppStreamServiceAccess
      Networking:
        SubnetId: {{ private_subnet_id }}
    - Name: queue2
      Iam:
        S3Access:
          - BucketName: {{ resource_bucket }}
            EnableWriteAccess: true
        AdditionalIamPolicies:
          - Policy: arn:aws:iam::aws:policy/service-role/AmazonAppStreamServiceAccess
      ComputeSettings:
        LocalStorage:
          RootVolume:
            size: 40
      CustomActions:
        - Script: s3://{{ bucket }}/scripts/preinstall.sh
          Args:
            - ABC
          Event: NODE_START
        - Script: s3://{{ bucket }}/scripts/postinstall.sh
          Args:
            - DEF
          Event: NODE_CONFIGURED
      ComputeResources:
        - Name: compute-resource-21
          InstanceType: c5n.18xlarge
          MaxCount: 1
          DisableSimultaneousMultithreading: true
          Efa:
            Enabled: true
      Networking:
        SubnetId: {{ private_subnet_id }}
    - Name: queue3
      Iam:
        S3Access:
          - BucketName: {{ resource_bucket }}
            EnableWriteAccess: true
        AdditionalIamPolicies:
          - Policy: arn:aws:iam::aws:policy/service-role/AmazonAppStreamServiceAccess
      ComputeSettings:
        LocalStorage:
          LocalStorage:
            RootVolume:
              size: 40
      CustomActions:
        - Script: s3://{{ bucket }}/scripts/preinstall.sh
          Args:
            - ABC
          Event: NODE_START
        - Script: s3://{{ bucket }}/scripts/postinstall.sh
          Args:
            - DEF
          Event: NODE_CONFIGURED
      ComputeResources:
        - Name: compute-resource-31
          InstanceType: c5n.18xlarge
          DisableSimultaneousMultithreading: true
          Efa:
            Enabled: true
        - Name: compute-resource-32
          InstanceType: t2.xlarge
          DisableSimultaneousMultithreading: true
          Efa:
            Enabled: true
      Networking:
        SubnetId: {{ private_subnet_id }}
SharedStorage:
  - MountDir: shared
    Name: ebs
    StorageType: Ebs
    EbsSettings:
      Iops: 140
  - MountDir: efs
    Name: efs
    StorageType: Efs
    EfsSettings:
      ThroughputMode: provisioned
      ProvisionedThroughput: 1024
  - MountDir: raid
    StorageType: Ebs
    Name: raid-type1
    EbsSettings:
      Iops: 110
      Raid:
        Type: 0
        NumberOfVolumes: 2
  - MountDir: fsx
      Name: fsx
      StorageType: FsxLustre
      FsxLustreSettings:
        StorageCapacity: 3600
        WeeklyMaintenanceStartTime: "3:02:30"
Monitoring:
  DetailedMonitoring: false
  Logs:
    CloudWatch:
      Enabled: true
      RetentionInDays: 1