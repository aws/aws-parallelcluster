{%- import 'common.jinja2' as common with context -%}
---
test-suites:
{{- common.OSS_COMMERCIAL_ARM.append("centos7") or "" -}}
{% filter indent(2) %}
{% include 'common/common.yaml' %}
{% endfilter %}
  efa:
    test_efa.py::test_efa:
      dimensions:
        - regions: ["use1-az6"]  # do not move, unless capacity reservation is moved as well
          instances: ["c5n.18xlarge"]
          oss: ["alinux2"]
          schedulers: ["slurm"]
        - regions: ["use1-az6"]   # do not move, unless capacity reservation is moved as well
          instances: ["p4d.24xlarge"]
          oss: ["alinux2"]
          schedulers: ["slurm"]
        - regions: ["use1-az6"]  # do not move, unless capacity reservation is moved as well
          instances: ["c6gn.16xlarge"]
          oss: ["rhel8"]
          schedulers: ["slurm"]
        - regions: ["use2-az2"]  # do not move, unless instance type support is moved as well
          instances: ["hpc6id.32xlarge"]
          oss: ["centos7"]
          schedulers: [ "slurm" ]
        - regions: ["use2-az2"]  # do not move, unless instance type support is moved as well
          instances: [{{ common.instance("instance_type_1") }}]
          oss: ["ubuntu2004"]
          schedulers: [ "slurm" ]
    test_fabric.py::test_fabric:
      dimensions:
        - regions: ["use1-az6"]  # do not move, unless capacity reservation is moved as well
          instances: ["p4d.24xlarge"]
          oss: ["alinux2"]
          schedulers: ["slurm"]
  # need to duplicate api section because test_official_images works only after release
  pcluster_api:
    test_api_infrastructure.py::test_api_infrastructure_with_default_parameters:
      dimensions:
        - regions: ["ap-south-1", "cn-north-1", "us-gov-west-1"]
    test_api.py::test_cluster_slurm:
      dimensions:
        - regions: ["sa-east-1"]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: ["alinux2"]
          schedulers: ["slurm"]
    test_api.py::test_cluster_awsbatch:
      dimensions:
        - regions: ["sa-east-1"]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: ["alinux2"]
          schedulers: ["awsbatch"]
    test_api.py::test_custom_image:
      dimensions:
        - regions: ["sa-east-1"]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: ["alinux2"]
  scaling:
    # FixMe: MPI tests configs are duplications of the test in common.yaml.
    # The duplications are necessary because the scaling section here overwrites the scaling section in common.yaml.
    test_mpi.py::test_mpi:  # TODO: move outside of the scaling dir
      dimensions:
        - regions: ["ap-east-1"]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: ["rhel8"]
          schedulers: ["slurm"]
        - regions: ["ca-central-1"]
          instances: {{ common.INSTANCES_DEFAULT_ARM }}
          oss: ["ubuntu2004"]
          schedulers: ["slurm"]
    test_mpi.py::test_mpi_ssh:
      dimensions:
        - regions: ["eu-north-1"]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: ["centos7"]
          schedulers: ["slurm"]
    test_scaling.py::test_multiple_jobs_submission:
      dimensions:
        - regions: ["us-west-2"]
          instances: {{ common.INSTANCES_DEFAULT_ARM }}
          oss: ["ubuntu2004"]
          schedulers: ["slurm"]
        - regions: ["cn-north-1"]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: ["alinux2"]
          schedulers: ["slurm"]
        - regions: ["us-gov-east-1"]
          instances: {{ common.INSTANCES_DEFAULT_X86 }}
          oss: ["rhel8"]
          schedulers: ["slurm"]
  trainium:
    test_trainium.py::test_trainium:
      dimensions:
        - regions: ["usw2-az4"]  # do not move, unless instance type support is moved as well
          schedulers: ["slurm"]
          oss: ["ubuntu2004"]
  custom_resource:
    test_cluster_custom_resource.py::test_cluster_create:
      dimensions:
        - oss: ["alinux2"]
          regions: ["us-east-2"]
    test_cluster_custom_resource.py::test_cluster_create_invalid:
      dimensions:
        - oss: ["alinux2"]
          regions: ["us-east-2"]
    test_cluster_custom_resource.py::test_cluster_update:
      dimensions:
        - oss: ["alinux2"]
          regions: ["us-east-2"]
    test_cluster_custom_resource.py::test_cluster_update_invalid:
      dimensions:
        - oss: ["alinux2"]
          regions: ["us-east-2"]
    test_cluster_custom_resource.py::test_cluster_update_tag_propagation:
      dimensions:
        - oss: [ "alinux2" ]
          regions: ["us-east-2"]
    test_cluster_custom_resource.py::test_cluster_delete_out_of_band:
      dimensions:
        - oss: ["alinux2"]
          regions: ["us-east-2"]
    test_cluster_custom_resource.py::test_cluster_delete_retain:
      dimensions:
        - oss: ["alinux2"]
          regions: ["us-east-2"]
    test_cluster_custom_resource.py::test_cluster_create_with_custom_policies:
      dimensions:
        - oss: ["alinux2"]
          regions: ["us-east-2"]
